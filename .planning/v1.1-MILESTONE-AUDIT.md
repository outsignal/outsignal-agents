---
milestone: v1.1
audited: 2026-02-27
status: gaps_found
scores:
  requirements: 7/21
  phases: 1/4
  integration: 6/8
  flows: 4/6
gaps:
  requirements:
    - id: "LEAD-04"
      status: "partial"
      phase: "Phase 7"
      claimed_by_plans: ["07-02-PLAN.md", "07-03-PLAN.md"]
      completed_by_plans: ["07-02-SUMMARY.md", "07-03-SUMMARY.md"]
      verification_status: "passed"
      evidence: "getClientForWorkspace throws misleading 'Workspace not found' when workspace exists but apiToken is null. Export flow surfaces generic 'Leads Agent failed' to user."
    - id: "LEAD-05"
      status: "partial"
      phase: "Phase 7"
      claimed_by_plans: ["07-01-PLAN.md"]
      completed_by_plans: []
      verification_status: "passed"
      evidence: "operations.ts created and used by agent tools, but MCP tools in src/mcp/leads-agent/tools/ bypass it entirely with inline Prisma queries. 6 operations have divergent implementations between agent and MCP paths."
    - id: "SCHEMA-01"
      status: "unsatisfied"
      phase: "Phase 8"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 8 not started"
    - id: "SCHEMA-02"
      status: "unsatisfied"
      phase: "Phase 8"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 8 not started"
    - id: "PORTAL-01"
      status: "unsatisfied"
      phase: "Phase 9"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 9 not started"
    - id: "PORTAL-02"
      status: "unsatisfied"
      phase: "Phase 9"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 9 not started"
    - id: "PORTAL-03"
      status: "unsatisfied"
      phase: "Phase 9"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 9 not started"
    - id: "PORTAL-04"
      status: "unsatisfied"
      phase: "Phase 9"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 9 not started"
    - id: "PORTAL-05"
      status: "unsatisfied"
      phase: "Phase 9"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 9 not started"
    - id: "NOTIF-01"
      status: "unsatisfied"
      phase: "Phase 9"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 9 not started"
    - id: "NOTIF-02"
      status: "unsatisfied"
      phase: "Phase 9"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 9 not started"
    - id: "DEPLOY-02"
      status: "unsatisfied"
      phase: "Phase 10"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 10 not started"
    - id: "DEPLOY-03"
      status: "unsatisfied"
      phase: "Phase 10"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 10 not started"
    - id: "DEPLOY-04"
      status: "unsatisfied"
      phase: "Phase 10"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 10 not started"
    - id: "DEPLOY-05"
      status: "unsatisfied"
      phase: "Phase 10"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 10 not started"
    - id: "DEPLOY-06"
      status: "unsatisfied"
      phase: "Phase 10"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 10 not started"
  integration:
    - from: "src/lib/agents/orchestrator.ts (delegateToLeads)"
      to: "src/lib/agents/leads.ts (runLeadsAgent)"
      issue: "conversationContext field declared in LeadsInput but not exposed in delegateToLeads Zod schema — multi-turn refinement starts fresh each delegation"
    - from: "src/lib/leads/operations.ts"
      to: "src/mcp/leads-agent/tools/*.ts"
      issue: "MCP tools bypass operations layer entirely — 6 operations have divergent inline Prisma implementations (LEAD-05 violation)"
  flows:
    - name: "Agent export to EmailBison"
      breaks_at: "getClientForWorkspace returns undefined for missing apiToken, causing misleading 'Workspace not found' error"
    - name: "Conversational refinement"
      breaks_at: "orchestrator delegateToLeads schema lacks conversationContext param — follow-up queries restart from scratch"
tech_debt:
  - phase: 07-leads-agent-dashboard
    items:
      - "conversationContext not wired through orchestrator delegation (multi-turn refinement broken)"
      - "Score credit-gate is prompt-only (no code-level confirm gate like MCP equivalent)"
      - "leadsConfig and leadsTools exported but never imported externally (dead exports)"
      - "07-01-SUMMARY.md missing requirements_completed for LEAD-05 in frontmatter"
---

# v1.1 Outbound Pipeline — Milestone Audit

**Audited:** 2026-02-27
**Status:** GAPS FOUND
**Score:** 7/21 requirements satisfied

## Milestone Goal

Complete the outbound pipeline loop — admin builds lists via natural language chat, client reviews and approves in a portal, system auto-deploys campaigns to EmailBison on approval.

## Phase Status

| Phase | Name | Status | Verification | Requirements |
|-------|------|--------|-------------|--------------|
| 7 | Leads Agent Dashboard | Complete | Passed (8/8 must-haves) | 7/7 satisfied (2 partial) |
| 8 | Schema + Admin Promotion | Not started | — | 0/2 |
| 9 | Client Portal Review + Approvals | Not started | — | 0/7 |
| 10 | Campaign Deploy Service | Not started | — | 0/5 |

## Requirements Coverage (3-Source Cross-Reference)

### Phase 7 Requirements (7 total)

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS.md | Final |
|--------|-------------|-------------|---------|-----------------|-------|
| LEAD-01 | Search from chat | passed | 07-02, 07-03 | [x] | satisfied |
| LEAD-02 | List CRUD from chat | passed | 07-02, 07-03 | [x] | satisfied |
| LEAD-03 | Score from chat | passed | 07-02, 07-03 | [x] | satisfied |
| LEAD-04 | Export from chat | passed | 07-02, 07-03 | [x] | partial |
| LEAD-05 | Shared operations layer | passed | missing | [x] | partial |
| LEAD-06 | AgentRun audit trail | passed | 07-02, 07-03 | [x] | satisfied |
| DEPLOY-01 | EmailBison API spike | passed | 07-04 | [x] | satisfied |

### Phases 8-10 Requirements (14 total — all unsatisfied, phases not started)

SCHEMA-01, SCHEMA-02, PORTAL-01 through PORTAL-05, NOTIF-01, NOTIF-02, DEPLOY-02 through DEPLOY-06

## Integration Check Results

### Connected (6/8 wiring paths verified)

1. ChatSidebar → /api/chat → orchestratorTools → delegateToLeads → runLeadsAgent → operations → Prisma
2. operations.ts → scorePersonIcp (shared with MCP score tool)
3. operations.ts → getListExportReadiness (shared with MCP export/list tools)
4. operations.ts → getClientForWorkspace → EmailBisonClient
5. runLeadsAgent → runAgent → AgentRun audit
6. Chat route → orchestrator config + tools

### Broken (2/8 wiring paths)

1. **conversationContext not wired** — declared in LeadsInput, handled in buildLeadsMessage, but orchestrator's delegateToLeads Zod schema doesn't expose it. Multi-turn refinement starts fresh.
2. **MCP tools bypass operations.ts** — 6 operations have divergent inline Prisma implementations. LEAD-05 intent violated.

### E2E Flow Status

| Flow | Status | Break Point |
|------|--------|-------------|
| Search people from chat | Complete | — |
| Create/manage lists from chat | Complete | — |
| Score list from chat | Complete | — |
| View list from chat | Complete | — |
| Export to EmailBison from chat | Partial | getClientForWorkspace misleading error on missing apiToken |
| Conversational refinement | Broken | orchestrator lacks conversationContext in delegation schema |

## Tech Debt (Phase 7)

1. conversationContext not wired through orchestrator delegation
2. Score credit-gate is prompt-only (no code-level confirm gate)
3. leadsConfig/leadsTools exported but unused externally
4. 07-01-SUMMARY.md missing requirements_completed for LEAD-05

## Actionable Issues

### High Priority (fix before Phase 8)

1. **LEAD-05 violation**: Migrate MCP tools to call operations.ts instead of inline Prisma — or accept the divergence and downgrade the requirement
2. **LEAD-04 export error**: Add apiToken check in operations.exportListToEmailBison before calling getClientForWorkspace — surface actionable error message

### Medium Priority (address in future phase)

3. **conversationContext wiring**: Add conversationContext to delegateToLeads Zod schema so multi-turn refinement works
4. **Score credit-gate**: Add code-level confirm step to match MCP equivalent

---

*Audited: 2026-02-27*
*Auditor: Claude (gsd-integration-checker + orchestrator)*
