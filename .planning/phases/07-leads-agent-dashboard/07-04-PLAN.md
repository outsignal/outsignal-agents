---
phase: 07-leads-agent-dashboard
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/spikes/emailbison-api.md
  - src/lib/emailbison/client.ts
autonomous: true
requirements: [DEPLOY-01]

must_haves:
  truths:
    - "EmailBison API spike note documents: campaign create, sequence step schema, lead upload, and lead-to-campaign assignment gap"
    - "Spike note includes verified request/response shapes from live probe"
    - "getSequenceSteps() in client.ts uses the correct API path /campaigns/{id}/sequence-steps"
    - "The broken path /campaigns/sequence-steps?campaign_id={id} is no longer in the codebase"
  artifacts:
    - path: ".planning/spikes/emailbison-api.md"
      provides: "DEPLOY-01 spike findings for Phase 10 planning"
      contains: "lead-to-campaign assignment"
      min_lines: 50
    - path: "src/lib/emailbison/client.ts"
      provides: "Fixed getSequenceSteps method"
      contains: "/campaigns/${campaignId}/sequence-steps"
  key_links:
    - from: "src/lib/emailbison/client.ts"
      to: "https://app.outsignal.ai/api"
      via: "API calls"
      pattern: "/campaigns/.*sequence-steps"
---

<objective>
Formalize the EmailBison API spike documentation and fix the broken getSequenceSteps API path.

Purpose: DEPLOY-01 requires the EmailBison API surface to be documented for Phase 10 planning. The spike was executed during research and the findings are already in 07-RESEARCH.md, but the CONTEXT.md decision requires a standalone planning doc at `.planning/spikes/emailbison-api.md`. Additionally, the research discovered a broken API path in `client.ts` that must be fixed.

Output: Verified spike doc + fixed client method.
</objective>

<execution_context>
@/Users/jjay/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jjay/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-leads-agent-dashboard/07-RESEARCH.md
@.planning/spikes/emailbison-api.md
@src/lib/emailbison/client.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify and finalize the EmailBison API spike doc</name>
  <files>.planning/spikes/emailbison-api.md</files>
  <action>
The spike doc at `.planning/spikes/emailbison-api.md` was already created during the research phase. Read it and verify it contains all required sections per the CONTEXT.md decisions:

**Required sections (verify all present):**
1. Summary of findings
2. Verified endpoints with request/response shapes:
   - `POST /leads` (lead creation)
   - `POST /campaigns` (campaign creation)
   - `POST /campaigns/{id}/duplicate` (campaign duplication)
   - `GET /campaigns/{id}/sequence-steps` (list sequence steps)
   - `POST /campaigns/{id}/sequence-steps` (add sequence steps — APPENDS, not replaces)
   - `DELETE /leads/{id}` and `DELETE /campaigns/{id}`
3. Sequence step schema (from live GET response)
4. Lead-to-campaign assignment gap documentation (all 404/405 probes listed)
5. Impact on Phase 7 (LEAD-04) and Phase 10 (DEPLOY-04) designs
6. Fix needed for `getSequenceSteps()` in `client.ts`

**If any section is missing**, add it using the data from `07-RESEARCH.md` section "EmailBison API Spike Findings (DEPLOY-01)".

**If all sections are present and complete**, no changes needed — confirm the doc satisfies DEPLOY-01.

The spike doc must also include the key constraints discovered:
- `wait_in_days` must be >= 1 (Pitfall 4)
- Sequence steps POST appends, not replaces (Pitfall 2)
- `title` field in POST sequence-steps request is ignored
- Campaign `name` in duplicate request is ignored
  </action>
  <verify>
    <automated>cd /Users/jjay/programs/outsignal-agents && test -f .planning/spikes/emailbison-api.md && grep -c "lead-to-campaign" .planning/spikes/emailbison-api.md && echo "PASS: spike doc exists and documents assignment gap"</automated>
  </verify>
  <done>
    - `.planning/spikes/emailbison-api.md` contains all required sections
    - Lead-to-campaign assignment gap is clearly documented
    - All verified endpoints have request/response shapes
    - Phase 10 impact is noted
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix getSequenceSteps broken API path</name>
  <files>src/lib/emailbison/client.ts</files>
  <action>
Fix the `getSequenceSteps` method in `src/lib/emailbison/client.ts`.

**Current (broken):**
```typescript
async getSequenceSteps(campaignId: number): Promise<SequenceStep[]> {
  return this.getAllPages<SequenceStep>(
    `/campaigns/sequence-steps?campaign_id=${campaignId}`,
  );
}
```

**Replace with (correct path confirmed by live API probe):**
```typescript
async getSequenceSteps(campaignId: number): Promise<SequenceStep[]> {
  return this.getAllPages<SequenceStep>(
    `/campaigns/${campaignId}/sequence-steps`,
  );
}
```

The old path `/campaigns/sequence-steps?campaign_id={id}` returns 404 on the live API. The correct RESTful path is `/campaigns/{id}/sequence-steps`, confirmed during the spike probe.

No other changes to client.ts are needed.
  </action>
  <verify>
    <automated>cd /Users/jjay/programs/outsignal-agents && grep "sequence-steps" src/lib/emailbison/client.ts && npx tsc --noEmit src/lib/emailbison/client.ts 2>&1 | head -10</automated>
  </verify>
  <done>
    - `getSequenceSteps` uses `/campaigns/${campaignId}/sequence-steps` path
    - The broken `/campaigns/sequence-steps?campaign_id=` path is no longer in the codebase
    - TypeScript compiles without errors
  </done>
</task>

</tasks>

<verification>
- `.planning/spikes/emailbison-api.md` exists and has >= 50 lines documenting all findings
- `grep "campaign_id=" src/lib/emailbison/client.ts` returns NO matches (broken path removed)
- `grep "/campaigns/\${campaignId}/sequence-steps" src/lib/emailbison/client.ts` returns a match (correct path)
- `npx tsc --noEmit` passes
</verification>

<success_criteria>
- DEPLOY-01 is satisfied: EmailBison campaign API capabilities are discovered and documented
- The spike doc provides all information Phase 10 planning needs, including the lead-to-campaign assignment gap
- The broken getSequenceSteps path is fixed, preventing 404 errors when fetching sequence steps
</success_criteria>

<output>
After completion, create `.planning/phases/07-leads-agent-dashboard/07-04-SUMMARY.md`
</output>
