---
plan: 09-03
phase: 09-client-portal-campaign-approval
title: "Portal Campaign List Page + Nav Update"
wave: 2
depends_on:
  - 09-01
  - 09-02
requirements:
  - PORTAL-01
  - PORTAL-07
files_modified:
  - src/app/(portal)/portal/campaigns/page.tsx
  - src/components/portal/campaign-card.tsx
  - src/components/portal/portal-nav.tsx
autonomous: true
---

# Plan 09-03: Portal Campaign List Page + Nav Update

## Goal

Build the portal campaigns list page at `/portal/campaigns` as a server component with `getPortalSession()` guard, showing all campaigns for the workspace as a card grid. Pending campaigns sort to the top with notification badges. Add "Campaigns" to PortalNav with a pending badge count.

## Context

- Portal pages follow the server component pattern established by `src/app/(portal)/portal/page.tsx` and `src/app/(portal)/portal/linkedin/page.tsx`: call `getPortalSession()` first, then do Prisma queries.
- PortalNav (`src/components/portal/portal-nav.tsx`) is a client component with a simple nav items array. Currently has "Dashboard" and "LinkedIn". Add "Campaigns".
- CONTEXT.md decision: Card grid layout, ALL campaigns shown, pending sorted to top with notification badge. Each card shows campaign name, status badge, channels (email/linkedin icons), and two small approval indicators.
- Brand color: `#F0FF7A`.
- Existing UI components available: Card, Badge, Button from shadcn/ui. lucide-react for icons (Mail, Linkedin, ChevronRight).

## must_haves

- [ ] `/portal/campaigns` page exists as a server component using `getPortalSession()`
- [ ] Page shows all campaigns for the session's workspace in a card grid
- [ ] Pending campaigns (status === 'pending_approval' with unapproved items) sort to the top
- [ ] Each card shows: campaign name, status badge, channel icons, two approval indicators (leads + content)
- [ ] Cards link to `/portal/campaigns/[id]` detail page
- [ ] PortalNav includes "Campaigns" link with pending badge count
- [ ] Workspace A user cannot see workspace B campaigns (enforced by session-scoped query)

## Tasks

<task id="09-03-T1">
<title>Create the campaign list server component page</title>
<details>

**File:** `src/app/(portal)/portal/campaigns/page.tsx` (NEW)

This is a server component. Pattern: call `getPortalSession()`, query campaigns, sort, render.

```typescript
import { getPortalSession } from "@/lib/portal-session";
import { listCampaigns } from "@/lib/campaigns/operations";
import { CampaignCard } from "@/components/portal/campaign-card";

export default async function PortalCampaignsPage() {
  const { workspaceSlug } = await getPortalSession();
  const campaigns = await listCampaigns(workspaceSlug);

  // Sort: pending_approval with unapproved items first, then rest by updatedAt desc
  const pending = campaigns.filter(
    (c) =>
      c.status === "pending_approval" &&
      (!c.leadsApproved || !c.contentApproved),
  );
  const rest = campaigns.filter(
    (c) =>
      !(
        c.status === "pending_approval" &&
        (!c.leadsApproved || !c.contentApproved)
      ),
  );
  const sorted = [...pending, ...rest];

  return (
    <div className="space-y-5">
      <div>
        <h1 className="text-2xl font-heading font-bold">Campaigns</h1>
        <p className="text-sm text-muted-foreground mt-1">
          Review and approve your campaigns
        </p>
      </div>

      {sorted.length === 0 ? (
        <div className="text-center py-12 text-muted-foreground">
          No campaigns yet. Your team will notify you when campaigns are ready for
          review.
        </div>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {sorted.map((campaign) => (
            <CampaignCard key={campaign.id} campaign={campaign} />
          ))}
        </div>
      )}
    </div>
  );
}
```

**Key details:**
- `listCampaigns(workspaceSlug)` already filters by workspace â€” no additional ownership check needed (PORTAL-07 satisfied by session-scoped query).
- Pending campaigns with at least one unapproved section are sorted to the top.

</details>
</task>

<task id="09-03-T2">
<title>Create the CampaignCard client component</title>
<details>

**File:** `src/components/portal/campaign-card.tsx` (NEW)

Client component for interactive hover and link behavior.

```tsx
"use client";

import Link from "next/link";
import { Card, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Mail, Linkedin, ChevronRight } from "lucide-react";
import { cn } from "@/lib/utils";

interface CampaignCardProps {
  campaign: {
    id: string;
    name: string;
    status: string;
    channels: string[];
    leadsApproved: boolean;
    contentApproved: boolean;
  };
}

const statusConfig: Record<string, { label: string; className: string }> = {
  draft: { label: "Draft", className: "bg-gray-100 text-gray-800" },
  internal_review: {
    label: "In Review",
    className: "bg-blue-100 text-blue-800",
  },
  pending_approval: {
    label: "Needs Approval",
    className: "bg-amber-100 text-amber-800",
  },
  approved: { label: "Approved", className: "bg-emerald-100 text-emerald-800" },
  deployed: { label: "Deployed", className: "bg-purple-100 text-purple-800" },
  active: { label: "Active", className: "bg-emerald-100 text-emerald-800" },
  paused: { label: "Paused", className: "bg-yellow-100 text-yellow-800" },
  completed: {
    label: "Completed",
    className: "bg-blue-100 text-blue-800",
  },
};

export function CampaignCard({ campaign }: CampaignCardProps) {
  const config = statusConfig[campaign.status] ?? {
    label: campaign.status,
    className: "bg-gray-100 text-gray-800",
  };

  const isPending =
    campaign.status === "pending_approval" &&
    (!campaign.leadsApproved || !campaign.contentApproved);

  return (
    <Link href={`/portal/campaigns/${campaign.id}`}>
      <Card
        className={cn(
          "transition-shadow hover:shadow-md cursor-pointer relative",
          isPending && "ring-2 ring-amber-300",
        )}
      >
        {/* Notification dot for pending campaigns */}
        {isPending && (
          <span className="absolute -top-1.5 -right-1.5 h-3 w-3 rounded-full bg-amber-500" />
        )}

        <CardContent className="pt-5 pb-4 px-5">
          <div className="flex items-start justify-between">
            <h3 className="font-heading font-semibold text-sm truncate pr-2">
              {campaign.name}
            </h3>
            <ChevronRight className="h-4 w-4 text-muted-foreground shrink-0 mt-0.5" />
          </div>

          <div className="flex items-center gap-2 mt-3">
            <Badge className={cn("text-xs", config.className)}>
              {config.label}
            </Badge>

            {/* Channel icons */}
            <div className="flex items-center gap-1 ml-auto">
              {campaign.channels.includes("email") && (
                <Mail className="h-3.5 w-3.5 text-muted-foreground" />
              )}
              {campaign.channels.includes("linkedin") && (
                <Linkedin className="h-3.5 w-3.5 text-muted-foreground" />
              )}
            </div>
          </div>

          {/* Approval indicators */}
          <div className="flex items-center gap-2 mt-3">
            <span
              className={cn(
                "inline-flex items-center text-xs px-2 py-0.5 rounded-full",
                campaign.leadsApproved
                  ? "bg-emerald-100 text-emerald-800"
                  : "bg-amber-100 text-amber-800",
              )}
            >
              Leads: {campaign.leadsApproved ? "Approved" : "Pending"}
            </span>
            <span
              className={cn(
                "inline-flex items-center text-xs px-2 py-0.5 rounded-full",
                campaign.contentApproved
                  ? "bg-emerald-100 text-emerald-800"
                  : "bg-amber-100 text-amber-800",
              )}
            >
              Content: {campaign.contentApproved ? "Approved" : "Pending"}
            </span>
          </div>
        </CardContent>
      </Card>
    </Link>
  );
}
```

**Key details:**
- Pending campaigns get an amber ring highlight and a notification dot.
- Status badge uses a config map for clean status-to-label mapping.
- Cards are clickable links to the detail page.

</details>
</task>

<task id="09-03-T3">
<title>Add Campaigns to PortalNav with pending badge</title>
<details>

**File:** `src/components/portal/portal-nav.tsx` (MODIFY)

The PortalNav is a client component. It currently has two static nav items. We need to add "Campaigns" as a third item. For the pending badge count, the page (server component) will pass it as a prop through the layout.

**Approach:** Since PortalNav is used from the layout and doesn't have access to server-side data directly, the simplest approach for now is to add the "Campaigns" nav item without a live badge count in the nav itself. The pending badge is visible on the campaign cards themselves and in the page heading. This avoids a complex data-passing refactor of the layout.

**Alternative considered:** Passing `pendingCount` as a prop from layout. But the portal layout (`src/app/(portal)/layout.tsx`) is a simple wrapper that doesn't fetch data. Adding a data fetch there would break the clean separation. The card-level notification badges (amber ring + dot) on the campaigns page are sufficient for PORTAL-01.

Update the `navItems` array:

```typescript
const navItems = [
  { href: "/portal", label: "Dashboard" },
  { href: "/portal/campaigns", label: "Campaigns" },
  { href: "/portal/linkedin", label: "LinkedIn" },
];
```

That is the only change needed. The `isActive` logic already handles non-root paths with `pathname.startsWith(item.href)`.

</details>
</task>

## Verification

```bash
# 1. Campaign list page exists
ls -la src/app/\(portal\)/portal/campaigns/page.tsx

# 2. Campaign card component exists
ls -la src/components/portal/campaign-card.tsx

# 3. PortalNav has Campaigns entry
grep "campaigns" src/components/portal/portal-nav.tsx

# 4. CampaignCard imports from correct UI components
grep "import" src/components/portal/campaign-card.tsx

# 5. TypeScript compiles
npx tsc --noEmit --pretty 2>&1 | head -30
```
