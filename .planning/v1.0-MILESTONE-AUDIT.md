---
milestone: v1.0
audited: 2026-02-27T12:00:00Z
previous_audit: 2026-02-26T23:45:00Z
status: gaps_found
scores:
  requirements: 17/29
  phases: 4/6
  integration: 16/17
  flows: 3/4
gaps:
  requirements:
    - id: "SEARCH-01"
      status: "orphaned"
      phase: "Phase 4"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 4 not started — no directory, plans, or verification"
    - id: "SEARCH-02"
      status: "orphaned"
      phase: "Phase 4"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 4 not started"
    - id: "SEARCH-03"
      status: "orphaned"
      phase: "Phase 4"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 4 not started"
    - id: "SEARCH-04"
      status: "orphaned"
      phase: "Phase 4"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 4 not started"
    - id: "SEARCH-05"
      status: "orphaned"
      phase: "Phase 4"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 4 not started"
    - id: "LIST-01"
      status: "orphaned"
      phase: "Phase 4"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 4 not started"
    - id: "LIST-02"
      status: "orphaned"
      phase: "Phase 4"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 4 not started"
    - id: "LIST-03"
      status: "orphaned"
      phase: "Phase 4"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 4 not started"
    - id: "LIST-04"
      status: "orphaned"
      phase: "Phase 4"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 4 not started"
    - id: "EXPORT-01"
      status: "orphaned"
      phase: "Phase 5"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 5 not started"
    - id: "EXPORT-02"
      status: "orphaned"
      phase: "Phase 5"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 5 not started"
    - id: "EXPORT-03"
      status: "orphaned"
      phase: "Phase 5"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 5 not started"
  integration:
    - id: "INT-02"
      from: "Phase 2 (provider adapters)"
      to: "Phase 3 (MCP leads agent)"
      connection: "Provider API keys → MCP server env"
      severity: "critical"
      reason: "PROSPEO_API_KEY, AIARK_API_KEY, FINDYMAIL_API_KEY not forwarded in .mcp.json env block — MCP enrich_person throws at runtime for 3 of 4 email providers"
      affected_requirements: ["ENRICH-02", "ENRICH-04", "PROV-01", "PROV-02", "PROV-04"]
      fix: "Add 3 entries to .mcp.json env block with ${VAR} syntax"
    - id: "INT-03"
      from: "Phase 3.1 (security hardening)"
      to: "Phase 2 (cost dashboard)"
      connection: "Auth guard → GET /api/enrichment/costs"
      severity: "minor"
      reason: "GET /api/enrichment/costs has no auth guard — cost data publicly accessible"
      affected_requirements: []
  flows:
    - name: "MCP enrich_person end-to-end"
      broken_at: "enrichEmail → provider adapters (Prospeo, AI Ark, FindyMail)"
      reason: "Missing PROSPEO_API_KEY, AIARK_API_KEY, FINDYMAIL_API_KEY in .mcp.json"
      affected_requirements: ["ENRICH-02", "ENRICH-04", "PROV-01", "PROV-04"]
tech_debt:
  - phase: 01-enrichment-foundation
    items:
      - "Stale comment in queue.ts line 59-66 ('Phase 1 no-op')"
  - phase: 02-provider-adapters-waterfall
    items:
      - "AI Ark X-TOKEN auth header — LOW confidence (may 401 in production)"
      - "FindyMail linkedin_url field name — MEDIUM confidence"
      - "Firecrawl extract() self-documented as deprecated"
      - "PROV-02/PROV-05 SUMMARY frontmatter gap (bookkeeping only)"
  - phase: 03-icp-qualification-leads-agent
    items:
      - "verifyEmail() missing workspaceSlug on recordEnrichment — verification costs lack workspace attribution"
      - "normalizationPrompt stored but not consumed by normalizers"
      - "outreachTonePrompt stored but not consumed (expected Phase 5)"
      - "export_to_emailbison CSV stub (Phase 5 scope)"
      - "GET /api/enrichment/costs has no auth guard"
  - phase: operational
    items:
      - "No Vercel Cron schedule for batch processing"
      - "CRON_SECRET env var needs Vercel configuration"
      - "Cost dashboard not linked in sidebar navigation"
resolved_since_first_audit:
  - id: "INT-01"
    description: "Missing auth guard on enrichment API routes"
    resolved_by: "Phase 3.1 — validateCronSecret with crypto.timingSafeEqual"
  - description: "TS2322 in emailbison-client.test.ts:76"
    resolved_by: "Phase 3.1 — double cast fix"
  - description: "dailyCostTotal absent from test mock setup"
    resolved_by: "Phase 3.1 — added to setup.ts"
  - description: ".mcp.json missing FIRECRAWL_API_KEY, ANTHROPIC_API_KEY, LEADMAGIC_API_KEY"
    resolved_by: "Phase 3.1 — added with ${VAR} syntax"
---

# Milestone v1.0 Audit Report

**Milestone:** v1.0 — Outsignal Lead Engine
**Audited:** 2026-02-27
**Previous audit:** 2026-02-26 (status: tech_debt, scoped to completed phases only)
**Status:** GAPS FOUND — 12 requirements orphaned (Phases 4/5 not started), 1 critical integration gap

---

## Executive Summary

17 of 29 v1 requirements are satisfied across 4 completed phases (1, 2, 3, 3.1). All completed phases passed verification with 44/44 truths confirmed.

**12 requirements remain orphaned** — mapped to Phase 4 (Search + List Building) and Phase 5 (Export + EmailBison) which have no phase directories, no plans, and no work done. These are part of the v1.0 milestone scope per REQUIREMENTS.md.

**1 critical integration gap** persists from the previous audit: `.mcp.json` is missing 3 provider API keys, breaking the MCP enrichment flow.

---

## Requirements Coverage (3-Source Cross-Reference)

### Satisfied Requirements (17/29)

| REQ-ID | Description | Phase | VERIFICATION | SUMMARY | REQS.md | Final |
|--------|-------------|-------|-------------|---------|---------|-------|
| ENRICH-01 | Dedup-first local DB check | 1 | SATISFIED | 01-01 | `[x]` | **satisfied** |
| ENRICH-02 | Person waterfall (Prospeo → AI Ark → LM → FM) | 2 | SATISFIED | 02-01 | `[x]` | **satisfied** |
| ENRICH-03 | Company waterfall (AI Ark → Firecrawl) | 2 | SATISFIED | 02-01 | `[x]` | **satisfied** |
| ENRICH-04 | Email finding waterfall | 2 | SATISFIED | 02-01 | `[x]` | **satisfied** |
| ENRICH-05 | Email verification via LeadMagic (hard gate) | 3 | SATISFIED | 03-01 | `[x]` | **satisfied** |
| ENRICH-06 | Enrichment provenance tracking | 1 | SATISFIED | 01-01 | `[x]` | **satisfied** |
| ENRICH-07 | Async batch enrichment | 1 | SATISFIED | 01-03 | `[x]` | **satisfied** |
| AI-01 | Industry classification via Claude | 1 | SATISFIED | 01-02 | `[x]` | **satisfied** |
| AI-02 | Company name normalization via Claude | 1 | SATISFIED | 01-02 | `[x]` | **satisfied** |
| AI-03 | Job title + seniority extraction via Claude | 1 | SATISFIED | 01-02 | `[x]` | **satisfied** |
| AI-04 | ICP qualification via Firecrawl + Haiku | 3 | SATISFIED | 03-01, 03-03 | `[x]` | **satisfied** |
| AI-05 | Custom AI prompts per workspace | 3 | SATISFIED | 03-01, 03-03 | `[x]` | **satisfied** |
| PROV-01 | Prospeo API integration | 2 | SATISFIED | 02-02 | `[x]` | **satisfied** |
| PROV-02 | AI Ark API (person + company) | 2 | SATISFIED | — | `[x]` | **satisfied*** |
| PROV-03 | LeadMagic API integration | 2 | SATISFIED | 02-02 | `[x]` | **satisfied** |
| PROV-04 | FindyMail API integration | 2 | SATISFIED | 02-02 | `[x]` | **satisfied** |
| PROV-05 | Firecrawl integration (ICP crawling) | 2 | SATISFIED | — | `[x]` | **satisfied*** |

*PROV-02/PROV-05 missing from SUMMARY frontmatter but verified with full evidence in VERIFICATION.md.

### Orphaned Requirements (12/29) — Phases Not Started

| REQ-ID | Description | Assigned Phase | Status |
|--------|-------------|----------------|--------|
| SEARCH-01 | Search people by name, email, company, job title | Phase 4 | **orphaned** |
| SEARCH-02 | Filter by vertical, enrichment status, workspace, company | Phase 4 | **orphaned** |
| SEARCH-03 | Search companies by name, domain, vertical | Phase 4 | **orphaned** |
| SEARCH-04 | Enrichment status indicators on records | Phase 4 | **orphaned** |
| SEARCH-05 | Paginate large result sets (14k+ people, 17k+ companies) | Phase 4 | **orphaned** |
| LIST-01 | Create named target lists scoped to workspace | Phase 4 | **orphaned** |
| LIST-02 | Add people to lists from search results (individual/bulk) | Phase 4 | **orphaned** |
| LIST-03 | Filter and segment leads by ICP criteria for lists | Phase 4 | **orphaned** |
| LIST-04 | View list contents with enrichment completeness summary | Phase 4 | **orphaned** |
| EXPORT-01 | Export list to EmailBison campaign (direct API push) | Phase 5 | **orphaned** |
| EXPORT-02 | Email verification gate before export | Phase 5 | **orphaned** |
| EXPORT-03 | Export list as CSV | Phase 5 | **orphaned** |

All 12 are mapped to phases in REQUIREMENTS.md traceability table but those phases have no directories, no plans, and no verification files.

---

## Phase Status

| Phase | Name | Plans | Status | Verification |
|-------|------|-------|--------|-------------|
| 1 | Enrichment Foundation | 3/3 | Complete | passed (13/13) |
| 2 | Provider Adapters + Waterfall | 6/6 | Complete | passed (19/19) |
| 3 | ICP Qualification + Leads Agent | 3/3 | Complete | passed (4/4) |
| 3.1 | API Security + Hardening | 2/2 | Complete | passed (8/8) |
| 4 | Search, Filter + List Building | 0/TBD | **Not started** | — |
| 5 | Export + EmailBison Integration | 0/TBD | **Not started** | — |

**Completed phases: 44/44 truths verified across all 4.**

---

## Cross-Phase Integration

**Score: 16/17 connections verified**

### Verified Connections (16)

| Connection | Status |
|------------|--------|
| dedup.ts → waterfall.ts (shouldEnrich before every provider) | WIRED |
| log.ts → waterfall.ts (recordEnrichment after every result) | WIRED |
| queue.ts → waterfall.ts (processNextChunk onProcess callback) | WIRED |
| All 6 providers → waterfall.ts (correct waterfall order) | WIRED |
| costs.ts → waterfall.ts (checkDailyCap/incrementDailySpend) | WIRED |
| normalizers → waterfall.ts (classifyJobTitle/CompanyName/Industry inline) | WIRED |
| merge.ts → waterfall.ts (null-guard merge strategy) | WIRED |
| MCP enrich → waterfall.ts (enrichEmail/enrichCompany) | WIRED |
| MCP score → scorer.ts (scorePersonIcp) | WIRED |
| MCP export → verification (verifyEmail/getVerificationStatus) | WIRED |
| crawl-cache.ts → firecrawl client (getCrawlMarkdown → scrapeUrl) | WIRED |
| scorer.ts → crawl-cache.ts (scorePersonIcp → getCrawlMarkdown) | WIRED |
| cron-auth.ts → enrichment routes (validateCronSecret first action) | WIRED |
| cost dashboard → /api/enrichment/costs (fetch in useEffect) | WIRED |
| .mcp.json → MCP server (DATABASE_URL, FIRECRAWL, ANTHROPIC, LEADMAGIC) | WIRED |
| verification → costs.ts (incrementDailySpend for leadmagic-verify) | WIRED |

### Integration Gaps (2)

**INT-02 (CRITICAL): MCP .mcp.json missing 3 provider API keys**

| Missing Key | Used By | Impact |
|-------------|---------|--------|
| PROSPEO_API_KEY | prospeoAdapter | MCP enrich_person fails for Prospeo |
| AIARK_API_KEY | aiarkPersonAdapter + aiarkAdapter | MCP enrich_person fails for AI Ark |
| FINDYMAIL_API_KEY | findymailAdapter | MCP enrich_person fails for FindyMail |

Fix: Add 3 entries to `.mcp.json` env block with `${VAR}` syntax.
Scope: MCP process only — Vercel batch routes have all keys from Vercel env.
Affected requirements: ENRICH-02, ENRICH-04, PROV-01, PROV-02, PROV-04

**INT-03 (MINOR): GET /api/enrichment/costs — no auth guard**

Cost/provider data publicly accessible. Phase 3.1 only hardened POST routes.
Fix: Add validateCronSecret or session check.

---

## E2E Flows

**Score: 3/4 flows complete**

| Flow | Status | Notes |
|------|--------|-------|
| Batch enrichment (auth → enqueue → waterfall → normalize → log) | COMPLETE | All wiring confirmed |
| ICP scoring (workspace prompt → crawl → Haiku → persist) | COMPLETE | MCP tool end-to-end |
| Export gate (verify → block non-valid → CSV) | COMPLETE | Hard "valid"-only policy |
| MCP enrich_person (enrich → waterfall → providers) | **BROKEN** | 3 provider keys missing from MCP env |

---

## Tech Debt Summary

**13 items across 4 categories**

### Phase 1 (1 item)
- Stale comment in queue.ts ("Phase 1 no-op")

### Phase 2 (4 items)
- AI Ark X-TOKEN auth header — LOW confidence (may 401 in production)
- FindyMail linkedin_url field name — MEDIUM confidence
- Firecrawl extract() self-documented as deprecated
- PROV-02/PROV-05 SUMMARY frontmatter gap (bookkeeping only)

### Phase 3 (5 items)
- verifyEmail() missing workspaceSlug on recordEnrichment — verification costs lack workspace attribution
- normalizationPrompt stored but not consumed by normalizers
- outreachTonePrompt stored but not consumed (expected Phase 5)
- export_to_emailbison CSV stub (explicitly Phase 5 scope)
- GET /api/enrichment/costs has no auth guard

### Operational (3 items)
- No Vercel Cron schedule for batch processing
- CRON_SECRET env var needs Vercel configuration
- Cost dashboard not linked in sidebar navigation

---

## Resolved Since First Audit (2026-02-26)

| Issue | Resolved By |
|-------|-------------|
| INT-01: Unauthenticated enrichment routes | Phase 3.1 — validateCronSecret |
| TS2322 in emailbison-client.test.ts | Phase 3.1 — double cast fix |
| dailyCostTotal missing from test mock | Phase 3.1 — added to setup.ts |
| .mcp.json missing FIRECRAWL, ANTHROPIC, LEADMAGIC keys | Phase 3.1 — added with ${VAR} syntax |

---

## Human Verification Items

1. **Live DB schema sync** — Confirm all Prisma models exist in Neon
2. **End-to-end person enrichment** — Trigger with real API keys, verify waterfall order
3. **End-to-end company enrichment** — Verify AI Ark → Firecrawl fallback
4. **Daily cap enforcement** — Set ENRICHMENT_DAILY_CAP_USD=0.001, verify pause
5. **Cost dashboard rendering** — Visual check of Recharts at /enrichment-costs
6. **ICP scoring end-to-end** — Configure workspace prompt, verify Haiku response
7. **Export hard gate** — Test with mixed-status emails, verify block

---

*Audited: 2026-02-27*
*Auditor: Claude (gsd audit-milestone)*
*Previous audit: 2026-02-26 (status: tech_debt)*
